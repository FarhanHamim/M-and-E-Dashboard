{% extends 'base.html' %}
{% load static %}

{% block title %}Register - M&E Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex">
    <!-- Left Panel - Branding & Info -->
    <div class="hidden lg:flex lg:w-1/2 relative overflow-hidden">
        <!-- Background Pattern -->
        <div class="absolute inset-0 bg-gradient-to-br from-blue-600 via-blue-700 to-blue-900"></div>
        <div class="absolute inset-0 opacity-10">
            <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.1"><circle cx="30" cy="30" r="4"/></g></svg>');"></div>
        </div>
        
        <!-- Content -->
        <div class="relative z-10 flex flex-col justify-center px-12 text-white">
            <!-- Logo Area -->
            <div class="mb-8">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl mb-6 shadow-xl">
                    <!-- Logo Placeholder - You can replace with actual logo -->
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold mb-4">Join M&E Dashboard</h1>
                <p class="text-xl text-blue-100 leading-relaxed">
                    Create your account and start monitoring development progress with powerful analytics tools
                </p>
            </div>

            <!-- Benefits -->
            <div class="space-y-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-rocket text-sm"></i>
                    </div>
                    <span class="text-blue-100">Get started in minutes</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-chart-bar text-sm"></i>
                    </div>
                    <span class="text-blue-100">Access comprehensive analytics</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-handshake text-sm"></i>
                    </div>
                    <span class="text-blue-100">Join a global community</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel - Registration Form -->
    <div class="flex-1 flex items-center justify-center px-6 py-12">
        <div class="w-full max-w-md">
            <!-- Mobile Logo -->
            <div class="lg:hidden text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4 shadow-lg">
                    <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">Join M&E Dashboard</h2>
            </div>

            <!-- Registration Card -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                <!-- Header -->
                <div class="px-8 pt-8 pb-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold text-gray-900 text-center">Create Account</h3>
                    <p class="text-gray-600 text-center mt-2">Join the monitoring community</p>
                </div>

                <!-- Form -->
                <form class="px-8 pt-6 pb-8 space-y-6" method="post" id="registerForm">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}

                    <!-- Username Field -->
                    <div class="space-y-2">
                        <label for="username" class="block text-sm font-medium text-gray-700">
                            Username <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-user text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="text" 
                                id="username"
                                name="username"
                                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Choose a username"
                                required
                                autocomplete="username"
                            >
                        </div>
                        <p class="text-xs text-gray-500">Must be unique and contain only letters, numbers, and underscores</p>
                    </div>

                    <!-- Email Field -->
                    <div class="space-y-2">
                        <label for="email" class="block text-sm font-medium text-gray-700">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-envelope text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="email" 
                                id="email"
                                name="email"
                                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Enter your email"
                                required
                                autocomplete="email"
                            >
                        </div>
                    </div>

                    <!-- First Name -->
                    <div class="space-y-2">
                        <label for="first_name" class="block text-sm font-medium text-gray-700">
                            First Name <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-user-circle text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="text" 
                                id="first_name"
                                name="first_name"
                                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Enter your first name"
                                required
                                autocomplete="given-name"
                            >
                        </div>
                    </div>

                    <!-- Last Name -->
                    <div class="space-y-2">
                        <label for="last_name" class="block text-sm font-medium text-gray-700">
                            Last Name <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-user-circle text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="text" 
                                id="last_name"
                                name="last_name"
                                class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Enter your last name"
                                required
                                autocomplete="family-name"
                            >
                        </div>
                    </div>

                    <!-- Password Field -->
                    <div class="space-y-2">
                        <label for="password1" class="block text-sm font-medium text-gray-700">
                            Password <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-lock text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="password" 
                                id="password1"
                                name="password1"
                                class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Create a strong password"
                                required
                                autocomplete="new-password"
                            >
                            <button type="button" onclick="togglePassword('password1')" class="absolute inset-y-0 right-0 pr-3 flex items-center justify-center">
                                <i class="fas fa-eye text-gray-400 hover:text-gray-600 text-sm"></i>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500">
                            <p>Password must contain:</p>
                            <ul class="list-disc list-inside ml-2 mt-1 space-y-1">
                                <li id="length-check" class="text-red-500">At least 8 characters</li>
                                <li id="number-check" class="text-red-500">At least one number</li>
                                <li id="letter-check" class="text-red-500">At least one letter</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Confirm Password Field -->
                    <div class="space-y-2">
                        <label for="password2" class="block text-sm font-medium text-gray-700">
                            Confirm Password <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center justify-center pointer-events-none">
                                <i class="fas fa-lock text-gray-400 text-sm"></i>
                            </div>
                            <input 
                                type="password" 
                                id="password2"
                                name="password2"
                                class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                                placeholder="Confirm your password"
                                required
                                autocomplete="new-password"
                            >
                            <button type="button" onclick="togglePassword('password2')" class="absolute inset-y-0 right-0 pr-3 flex items-center justify-center">
                                <i class="fas fa-eye text-gray-400 hover:text-gray-600 text-sm"></i>
                            </button>
                        </div>
                        <div id="password-match" class="text-xs text-red-500 hidden">
                            Passwords do not match
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="flex items-start space-x-3">
                        <input 
                            id="terms" 
                            name="terms" 
                            type="checkbox" 
                            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1"
                            required
                        >
                        <label for="terms" class="text-sm text-gray-700">
                            I agree to the 
                            <a href="#" class="text-blue-600 hover:text-blue-600-dark font-medium">Terms of Service</a> 
                            and 
                            <a href="#" class="text-blue-600 hover:text-blue-600-dark font-medium">Privacy Policy</a>
                        </label>
                    </div>

                    <!-- Register Button -->
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-600-dark text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        <i class="fas fa-user-plus mr-2"></i>
                        Create Account
                    </button>

                    <!-- Login Link -->
                    <div class="text-center pt-4 border-t border-gray-100">
                        <p class="text-sm text-gray-600">
                            Already have an account? 
                            <a href="{% url 'login' %}" class="font-medium text-blue-600 hover:text-blue-600-dark transition-colors">
                                Sign in here
                            </a>
                        </p>
                    </div>
                </form>
            </div>

            <!-- Security Notice -->
            <div class="mt-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-4 border border-green-200">
                <div class="flex items-center space-x-2 text-green-700">
                    <i class="fas fa-shield-alt"></i>
                    <span class="text-sm font-medium">Your account is secure</span>
                </div>
                <p class="text-xs text-green-600 mt-1">
                    We use industry-standard encryption to protect your data and ensure your privacy.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus on username field
    const usernameField = document.getElementById('username');
    if (usernameField) {
        usernameField.focus();
    }

    // Password strength validation
    const password1 = document.getElementById('password1');
    const password2 = document.getElementById('password2');
    
    if (password1) {
        password1.addEventListener('input', function() {
            validatePasswordStrength(this.value);
        });
    }
    
    if (password2) {
        password2.addEventListener('input', function() {
            validatePasswordMatch();
        });
    }

    // Form validation
    const form = document.getElementById('registerForm');
    form.addEventListener('submit', function(e) {
        if (!validateForm()) {
            e.preventDefault();
            return false;
        }
        
        // Add loading state
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Account...';
        submitBtn.disabled = true;
        
        // Re-enable after 5 seconds in case of error
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 5000);
    });

    // Username availability check (optional - can be implemented with AJAX)
    const usernameInput = document.getElementById('username');
    if (usernameInput) {
        let timeout;
        usernameInput.addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                checkUsernameAvailability(this.value);
            }, 500);
        });
    }
});

function validatePasswordStrength(password) {
    const lengthCheck = document.getElementById('length-check');
    const numberCheck = document.getElementById('number-check');
    const letterCheck = document.getElementById('letter-check');
    
    // Length check
    if (password.length >= 8) {
        lengthCheck.textContent = 'At least 8 characters ✓';
        lengthCheck.className = 'text-green-500';
    } else {
        lengthCheck.textContent = 'At least 8 characters';
        lengthCheck.className = 'text-red-500';
    }
    
    // Number check
    if (/\d/.test(password)) {
        numberCheck.textContent = 'At least one number ✓';
        numberCheck.className = 'text-green-500';
    } else {
        numberCheck.textContent = 'At least one number';
        numberCheck.className = 'text-red-500';
    }
    
    // Letter check
    if (/[a-zA-Z]/.test(password)) {
        letterCheck.textContent = 'At least one letter ✓';
        letterCheck.className = 'text-green-500';
    } else {
        letterCheck.textContent = 'At least one letter';
        letterCheck.className = 'text-red-500';
    }
}

function validatePasswordMatch() {
    const password1 = document.getElementById('password1').value;
    const password2 = document.getElementById('password2').value;
    const matchDiv = document.getElementById('password-match');
    
    if (password2 && password1 !== password2) {
        matchDiv.classList.remove('hidden');
        matchDiv.textContent = 'Passwords do not match';
        matchDiv.className = 'text-xs text-red-500';
    } else if (password2 && password1 === password2) {
        matchDiv.classList.remove('hidden');
        matchDiv.textContent = 'Passwords match ✓';
        matchDiv.className = 'text-xs text-green-500';
    } else {
        matchDiv.classList.add('hidden');
    }
}

function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = field.nextElementSibling.querySelector('i');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function validateForm() {
    const requiredFields = ['username', 'email', 'first_name', 'last_name', 'password1', 'password2'];
    let isValid = true;
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
            field.style.borderColor = '#ef4444';
            isValid = false;
        } else {
            field.style.borderColor = '';
        }
    });
    
    // Check password match
    const password1 = document.getElementById('password1').value;
    const password2 = document.getElementById('password2').value;
    if (password1 !== password2) {
        alert('Passwords do not match. Please check and try again.');
        isValid = false;
    }
    
    // Check terms acceptance
    const terms = document.getElementById('terms');
    if (!terms.checked) {
        alert('Please accept the Terms of Service and Privacy Policy.');
        isValid = false;
    }
    
    return isValid;
}

function checkUsernameAvailability(username) {
    if (username.length < 3) return;
    
    // This would typically make an AJAX call to check username availability
    // For now, we'll just validate the format
    const usernameRegex = /^[a-zA-Z0-9_]+$/;
    if (!usernameRegex.test(username)) {
        // Show error message
        console.log('Username can only contain letters, numbers, and underscores');
    }
}
</script>
{% endblock %}
